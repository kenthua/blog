---
author: Kent Hua
blogger_id: tag:blogger.com,1999:blog-3324719914062696225.post-7800881177388485304
blogger_orig_url: http://blog.kenthua.com/2015/05/jboss-bpm-suite-61-design-time-runtime.html
comments: true
date: "2015-05-12T18:03:00Z"
modified_time: "2015-05-20T14:52:21.597-07:00"
tags: null
title: JBoss BPM Suite 6.1 Design Time / Runtime Clustering
---

JBoss BPM Suite can be clustered both in Design time and Runtime.<br /><br />For Design time, clustering leverages Apache Zookeeper and Apache Helix, to replicate the git repo.<br />For Runtime, the container manages most of the clustering &amp; HA, however, if you choose to use timers in your process or the execution server, you will need to configure one extra component, Quartz.<br /><br /><b>Disclaimer</b>: These configurations are for getting a test BPM cluster environment up and running. &nbsp;It may not work on your environment without modifications. &nbsp;This is not a production environment setup, modifications, updates, tweaks, multiple hosts and security hardening may be necessary.<br /><br />Acquire your binaries from the Red Hat Customer Portal. &nbsp;The postgresql driver is available from postgresql.org.<br /><br />As of this writing you need the following binaries:<br />jboss-eap-6.4.0.zip<br />jboss-bpmsuite-6.1.0.GA-deployable-eap6.x.zip<br />jboss-bpmsuite-6.1.0.GA-supplementary-tools.zip<br />postgresql-9.2-1002.jdbc4.jar<br /><br />After following these instructions you should end up with a 2 node design &amp; runtime cluster. &nbsp;The configurations and instructions are for installing onto single host (localhost). &nbsp;Configurations and some instructions will need to be tweaked if you desire to install on multiple hosts.<br /><br /><br /><b><u>Setup NODE 1&nbsp;</u></b><br />Unzip the binaries<br /><pre><code class="bash"><br />mkdir -p /tmp/bpmcluster<br />cd /tmp/bpmcluster/<br />unzip jboss-bpmsuite-6.1.0.GA-supplementary-tools.zip<br /><br />mkdir -p /tmp/bpmcluster/node1<br />cd /tmp/bpmcluster/node1<br />unzip jboss-eap-6.4.0.zip<br />unzip -u jboss-bpmsuite-6.1.0.GA-deployable-eap6.x.zip<br /></code></pre><div><br /></div><b>Setup Postgres Database</b><br /><br />Login to postgres<br />The quartz database script needs to be executed externally.  Creation of the bpms database assumes ownership as noted below in the command, this is not typical in most customer environments. <br /><div><pre><code class="bash"><br />sudo su - postgres<br />psql<br /><br />CREATE USER bpms WITH PASSWORD 'bpms';<br />CREATE DATABASE bpms OWNER bpms;<br />\q<br /><br />psql -U bpms bpms<br />\i /tmp/bpmcluster/jboss-brms-bpmsuite-6.1.0.GA-redhat-2-supplementary-tools/ddl-scripts/postgresql/quartz_tables_postgres.sql<br />\q<br /></code></pre>Optional depending on database privileges.  The applications can automatically create the tables via hibernate, if allowed.   <br /><pre><code class="bash"> <br />\i /tmp/bpmcluster/jboss-brms-bpmsuite-6.1.0.GA-redhat-2-supplementary-tools/ddl-scripts/postgresql/postgresql-jbpm-schema.sql<br />\i /tmp/bpmcluster/jboss-brms-bpmsuite-6.1.0.GA-redhat-2-supplementary-tools/ddl-scripts/postgresql/postgres-dashbuilder-schema.sql<br /></code></pre></div><br />Return to your regular user account<br /><br /><div><b>Setup Zookeeper</b></div><div><pre><code class="bash"><br />cd /tmp/bpmcluster/jboss-brms-bpmsuite-6.1.0.GA-redhat-2-supplementary-tools/zookeeper</code></pre></div><br />Copy zookeeper/conf/zoo_sample.cfg to zoo.cfg<br /><pre><code class="bash"><br />cp zoo_sample.cfg zoo.cfg</code></pre><br />Modify zoo.cfg<br />Update the the following to your choosing<br /><pre><code class="bash"><br />dataDir=/tmp/zookeeper # make sure the folder exists prior to starting zookeeper<br /><br />clientPort=2181</code></pre><br /><b>Start Zookeeper</b><br /><pre><code class="bash"><br />cd /tmp/bpmcluster/jboss-brms-bpmsuite-6.1.0.GA-redhat-2-supplementary-tools/zookeeper/bin<br /><br />./zkServer.sh start</code></pre><br />Logs will be in zookeeper.out<br /><br /><br /><b>Setup Helix</b><br /><pre><code class="bash"><br />cd /tmp/bpmcluster/jboss-brms-bpmsuite-6.1.0.GA-redhat-2-supplementary-tools/helix-core/bin</code></pre><br />Create the BPM Cluster<br /><div><pre><code class="bash"><br />./helix-admin.sh --zkSvr localhost:2181&nbsp;--addCluster bpmCluster</code></pre></div><div><br /></div><div>Add node1 to bpmCluster</div><div><pre><code class="bash"><br />./helix-admin.sh --zkSvr localhost:2181 --addNode bpmCluster localhost_bpmClusterNode1</code></pre></div><div><br /></div><div>Add node2 to bpmCluster</div><div><pre><code class="bash"><br />./helix-admin.sh --zkSvr localhost:2181 --addNode bpmCluster localhost_bpmClusterNode2</code></pre></div><div><br /></div><div>Add the resource vfs-repo to bpmCluster, configure the cluster for LeaderStandby mode</div><div>This means that one node will be primary and the other nodes will be a slave, replication only goes from the primary to the slaves</div><pre><code class="bash"><br />./helix-admin.sh --zkSvr localhost:2181 --addResource bpmCluster vfs-repo 1 LeaderStandby AUTO_REBALANCE</code></pre><br />Tell the cluster to rebalance and initialize<br /><pre><code class="bash"><br />./helix-admin.sh --zkSvr localhost:2181 --rebalance bpmCluster vfs-repo 2</code></pre><br /><br /><b>Start Helix on Node 1</b><br />You only need 1 helix-controller for each OS you want managed. &nbsp;We are installing both bpm nodes on the same OS, so we only need 1 helix-controller. &nbsp;If you have mulitple hosts (OS), each host will need to run the helix controller as well.<br /><div><div><pre><code class="bash"><br />nohup ./run-helix-controller.sh --zkSvr localhost:2181 --cluster bpmCluster 2&gt;&amp;1 &gt; ./controller.log &amp;</code></pre></div></div><br />Logs will be in controller.log<br /><br /><br /><b>Now to modify your EAP NODE 1 instance</b><br /><pre><code class="bash"><br />cd /tmp/bpmcluster/node1/jboss-eap-6.4<br /></code></pre>EAP Configuration<br />When you unzipped the bpm binaries, it overwrote the standalone configuration files. <br /><br />Some of these configurations will be slightly different for each node. &nbsp;For instance paths, hosts, and port numbers. <br /><div><br /></div>standalone/configuration/standalone-full-ha.xml<br /><br /><b>Add the following to the &lt;system-properties&gt; section.</b><br /><pre><code class="xml"><br />&lt;property name="jboss.node.name" value="<b>node1</b>"/&gt;<br />&lt;property name="org.uberfire.nio.git.dir" value="<b>/tmp/bpmcluster/node1/jboss-eap-6.4/bin/repo</b>"/&gt;<br />&lt;property name="org.quartz.properties" value="<b>/tmp/bpmcluster/node1/jboss-eap-6.4/standalone/configuration/quartz-definition.properties</b>"/&gt;<br />&lt;property name="org.uberfire.nio.git.daemon.enabled" value="true" /&gt;<br />&lt;property name="org.uberfire.nio.git.daemon.host" value=â€œ<b>localhost</b>" /&gt;<br />&lt;property name="org.uberfire.nio.git.daemon.port" value="<b>9418</b>" /&gt;<br />&lt;property name="org.uberfire.nio.git.ssh.enabled" value="true" /&gt;<br />&lt;property name="org.uberfire.nio.git.ssh.host" value="<b>localhost</b>" /&gt;<br />&lt;property name="org.uberfire.nio.git.ssh.port" value="<b>8001</b>" /&gt;<br />&lt;property name="org.uberfire.cluster.id" value="bpmCluster"/&gt;<br />&lt;property name="org.uberfire.cluster.zk" value="<b>localhost:2181</b>"/&gt;<br />&lt;property name="org.uberfire.cluster.local.id" value="<b>localhost_bpmClusterNode1</b>"/&gt;<br />&lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo"/&gt;<br />&lt;property name="org.uberfire.metadata.index.dir" value="<b>/tmp/bpmcluster/node1/jboss-eap-6.4/bin/index</b>"/&gt;<br />&lt;property name="org.uberfire.cluster.autostart" value="false"/&gt;<br /></code></pre><br /><b>Add the following datasource / driver definitions for postgres, &lt;datasources&gt; section:</b><br /><pre><code class="xml"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;datasource&nbsp;jta="false"&nbsp;jndi-name="java:jboss/datasources/bpmsNOXADS"&nbsp;pool-name="java:jboss/datasources/bpmsNOXADS_Pool"&nbsp;enabled="true"&nbsp;use-java-context="true"&nbsp;use-ccm="true"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;connection-url&gt;jdbc:postgresql://localhost:5432/bpms&lt;/connection-url&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;driver&gt;postgresql&lt;/driver&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;security&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;user-name&gt;bpms&lt;/user-name&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;password&gt;bpms&lt;/password&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/security&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/datasource&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;datasource&nbsp;jta="true"&nbsp;jndi-name="java:jboss/datasources/bpmsDS"&nbsp;pool-name="java:jboss/datasources/bpmsDS_Pool"&nbsp;enabled="true"&nbsp;use-java-context="true"&nbsp;use-ccm="true"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;connection-url&gt;jdbc:postgresql://localhost:5432/bpms&lt;/connection-url&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;driver&gt;postgresqlXA&lt;/driver&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;security&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;user-name&gt;bpms&lt;/user-name&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;password&gt;bpms&lt;/password&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/security&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/datasource&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;drivers&gt;</code></pre><pre><code class="xml"><pre><code class="xml">                    &lt;driver&nbsp;name="postgresql"&nbsp;module="org.postgresql"&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;datasource-class&gt;org.postgresql.Driver&lt;/datasource-class&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/driver&gt;</code></pre>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;driver&nbsp;name="postgresqlXA"&nbsp;module="org.postgresql"&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;xa-datasource-class&gt;org.postgresql.xa.PGXADataSource&lt;/xa-datasource-class&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/driver&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/drivers&gt; </code></pre><br /><b>Add the postgres db driver to EAP</b><br /><pre><code class="bash"><br />mkdir -p /tmp/bpmcluster/node1/jboss-eap-6.4/modules/system/layers/base/org/postgresql/main<br />cd /tmp/bpmcluster/node1/jboss-eap-6.4/modules/system/layers/base/org/postgresql/main<br /></code></pre><br />Create a file called module.xml with the following contents<br /><pre><code class="bash"><br />&lt;?xml&nbsp;version="1.0"&nbsp;encoding="UTF-8"?&gt;<br />&lt;module&nbsp;xmlns="urn:jboss:module:1.1"&nbsp;name="org.postgresql"&gt;<br />&nbsp; &nbsp; &lt;resources&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;resource-root&nbsp;path="postgresql-9.2-1002.jdbc4.jar"/&gt;<br />&nbsp; &nbsp; &lt;/resources&gt;<br />&nbsp; &nbsp; &lt;dependencies&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;module&nbsp;name="javax.api"/&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;module&nbsp;name="javax.transaction.api"/&gt;<br />&nbsp; &nbsp; &lt;/dependencies&gt;<br />&lt;/module&gt;<br /></code></pre><div><br /></div><div>Copy your postgres db driver to this location</div><div><br /></div><div><br /></div><div><b>Setup the quartz property file. &nbsp;You've already set up the datasources above.</b></div><div><pre><code class="bash"><br />cd /tmp/bpmcluster/node1/jboss-eap-6.4/standalone/configuration</code></pre></div><div><br /></div><div>Create a file called quartz-definition.properties with the following contents</div><div><pre><code class="bash"><br />#============================================================================<br /># Configure Main Scheduler Properties<br />#============================================================================<br />org.quartz.scheduler.instanceName = jBPMClusteredScheduler<br />org.quartz.scheduler.instanceId = AUTO<br />#============================================================================<br /># Configure ThreadPool<br />#============================================================================<br />org.quartz.threadPool.class = org.quartz.simpl.SimpleThreadPool<br />org.quartz.threadPool.threadCount = 5<br />org.quartz.threadPool.threadPriority = 5<br />#============================================================================<br /># Configure JobStore<br />#============================================================================<br />org.quartz.jobStore.misfireThreshold = 60000<br />org.quartz.jobStore.class=org.quartz.impl.jdbcjobstore.JobStoreCMT<br />org.quartz.jobStore.driverDelegateClass=org.quartz.impl.jdbcjobstore.PostgreSQLDelegate<br />org.quartz.jobStore.useProperties=false<br />org.quartz.jobStore.dataSource=managedDS<br />org.quartz.jobStore.nonManagedTXDataSource=notManagedDS<br />org.quartz.jobStore.tablePrefix=QRTZ_<br />org.quartz.jobStore.isClustered=true<br />org.quartz.jobStore.clusterCheckinInterval = 20000<br />#============================================================================<br /># Configure Datasources<br />#============================================================================<br />org.quartz.dataSource.managedDS.jndiURL=jboss/datasources/bpmsDS<br />org.quartz.dataSource.notManagedDS.jndiURL=jboss/datasources/bpmsNOXADS<br /></code></pre><div><br /></div><div><b>Modify the application property files to associate the appropriate datasource and database configurations</b></div><div><br /></div><div>business-central.war</div><div>Modify the jta-data-source and hibernate-dialect properties</div><div><pre><code class="bash"><br />vi /tmp/bpmcluster/node1/jboss-eap-6.4/standalone/deployments/business-central.war/WEB-INF/classes/META-INF/persistence.xml</code></pre></div><div><div><pre><code class="xml"><br />&lt;jta-data-source&gt;java:jboss/datasources/bpmsDS&lt;/jta-data-source&gt;<br />&lt;property name="hibernate.dialect" value="org.hibernate.dialect.PostgreSQLDialect" /&gt;<br /></code></pre></div><div><br /></div><div>dashbuilder.war</div><div>Modify the jndi-name and add the postgres module</div><div><pre><code class="bash"><br />vi /tmp/bpmcluster/node1/jboss-eap-6.4/standalone/deployments/dashbuilder.war/WEB-INF/jboss-web.xml</code></pre></div><div><div><pre><code class="xml"><br />&lt;jndi-name&gt;java:jboss/datasources/bpmsDS&lt;/jndi-name&gt;</code></pre></div></div><div><pre><code class="bash"><br />vi /tmp/bpmcluster/node1/jboss-eap-6.4/standalone/deployments/dashbuilder.war/WEB-INF/jboss-deployment-structure.xml</code></pre></div><div><div><pre><code class="xml"><br />&lt;module&nbsp;name="org.postgresql"&nbsp;/&gt;</code></pre></div><div><br /></div><div>Force the apps to redeploy on the start of the EAP instance</div><pre><code class="bash"><br />touch /tmp/bpmcluster/node1/jboss-eap-6.4/standalone/deployments/business-central.war.dodeploy<br />touch /tmp/bpmcluster/node1/jboss-eap-6.4/standalone/deployments/dashbuilder.war.dodeploy<br /></code></pre><div><br /></div><div>Add an application admin user with the group admin&nbsp;</div><div><pre><code class="bash"><br />cd /tmp/bpmcluster/node1/jboss-eap-6.4/bin<br />./adduser.sh</code></pre></div></div><div><br /></div><div></div><br /><br /><b>Setup EAP NODE 2</b><br />You can zip up your EAP NODE 1 configuration and unzip it to a node2 folder or refollow the steps from EAP NODE 1<br /><pre><code class="bash"><br />cd /tmp/bpmcluster/node1<br />zip -r jbosseap.zip jboss-eap-6.4<br />mkdir -p /tmp/bpmcluster/node2<br />cd /tmp/bpmcluster/node2<br />unzip ../node1/jbosseap.zip<br /></code></pre><br />Modify the standalone-full-ha.xml system-properties<br /><pre><code class="xml"><br />&lt;property name="jboss.node.name" value="<b>node2</b>"/&gt;<br />&lt;property name="org.uberfire.nio.git.dir" value="<b>/tmp/bpmcluster/node2/jboss-eap-6.4/bin/repo</b>"/&gt;<br />&lt;property name="org.quartz.properties" value="<b>/tmp/bpmcluster/node2/jboss-eap-6.4/standalone/configuration/quartz-definition.properties</b>"/&gt;<br />&lt;property name="org.uberfire.nio.git.daemon.enabled" value="true" /&gt;<br />&lt;property name="org.uberfire.nio.git.daemon.host" value=â€œ<b>localhost</b>" /&gt;<br />&lt;property name="org.uberfire.nio.git.daemon.port" value="<b>9419</b>" /&gt;<br />&lt;property name="org.uberfire.nio.git.ssh.enabled" value="true" /&gt;<br />&lt;property name="org.uberfire.nio.git.ssh.host" value="<b>localhost</b>" /&gt;<br />&lt;property name="org.uberfire.nio.git.ssh.port" value="<b>8002</b>" /&gt;<br />&lt;property name="org.uberfire.cluster.id" value="bpmCluster"/&gt;<br />&lt;property name="org.uberfire.cluster.zk" value="<b>localhost:2181</b>"/&gt;<br />&lt;property name="org.uberfire.cluster.local.id" value="<b>localhost_bpmClusterNode2</b>"/&gt;<br />&lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo"/&gt;<br />&lt;property name="org.uberfire.metadata.index.dir" value="<b>/tmp/bpmcluster/node2/jboss-eap-6.4/bin/index</b>"/&gt;<br />&lt;property name="org.uberfire.cluster.autostart" value="false"/&gt;<br /></code></pre><div><br /></div><b>Start your EAP instances</b><br />The messaging cluster password is necessary. &nbsp;This property can also be modified in the standalone-full-ha.xml so that it doesn't need to be specified as a command line argument<br /><br />EAP NODE 1<br /><pre><code class="bash"><br />cd /tmp/bpmcluster/node1/jboss-eap-6.4/bin<br />./standalone.sh -c standalone-full-ha.xml -Djboss.messaging.cluster.password=password</code></pre><br />EAP NODE 2<br /><pre><code class="bash"><br />cd /tmp/bpmcluster/node2/jboss-eap-6.4/bin<br />./standalone.sh -c standalone-full-ha.xml -Djboss.messaging.cluster.password=password&nbsp;-Djboss.socket.binding.port-offset=100</code></pre><br /><br /><br /><b>*** NOTES ***</b><br /><ul><li>Console log printing - by default, the console log is not configured for standalone-full-ha.xml</li></ul><br />For each EAP Node, you can run the following jboss cli command from the bin folder.<br /><br />EAP NODE 1<br /><pre><code class="bash"><br />./jboss-cli.sh&nbsp;<br />connect localhost:9999<br />/subsystem=logging/console-handler=CONSOLE:add(level=INFO,formatter="%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n")<br />/subsystem=logging/root-logger=ROOT:add-handler(name="CONSOLE")<br /></code></pre><br />EAP NODE 2<br /><pre><code class="bash"><br />./jboss-cli.sh&nbsp;<br />connect localhost:10099<br />/subsystem=logging/console-handler=CONSOLE:add(level=INFO,formatter="%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n")<br />/subsystem=logging/root-logger=ROOT:add-handler(name="CONSOLE")<br /></code></pre><div><br /></div><div><ul><li>If running on OS X, hornetq may have an issue with multicast. &nbsp;Enable the appropriate route.</li></ul></div><div><pre><code class="bash">sudo route add 224.0.0.0 127.0.0.1 -netmask 240.0.0.0</code></pre></div><div><div><pre><code class="java"><br />16:08:14,988&nbsp;ERROR&nbsp;[org.hornetq.core.server]&nbsp;(Thread-0&nbsp;(HornetQ-scheduled-threads-2044127527))&nbsp;HQ224033:&nbsp;Failed&nbsp;to&nbsp;broadcast&nbsp;connector&nbsp;configs:&nbsp;java.io.IOException:&nbsp;Can't&nbsp;assign&nbsp;requested&nbsp;address<br />&nbsp; &nbsp; at&nbsp;java.net.PlainDatagramSocketImpl.send(Native&nbsp;Method)&nbsp;[rt.jar:1.7.0_76]<br />&nbsp; &nbsp; at&nbsp;java.net.DatagramSocket.send(DatagramSocket.java:697)&nbsp;[rt.jar:1.7.0_76]<br />&nbsp; &nbsp; at&nbsp;org.hornetq.api.core.UDPBroadcastGroupConfiguration$UDPBroadcastEndpoint.broadcast(UDPBroadcastGroupConfiguration.java:136)&nbsp;[hornetq-core-client-2.3.25.Final-redhat-1.jar:2.3.25.Final-redhat-1]</code></pre></div></div><div><br /></div><div><ul><li>You can list the helix zookeeper configuration information by running the following command</li></ul></div><div><pre><code class="bash">./helix-admin.sh&nbsp;--zkSvr&nbsp;localhost:2181&nbsp;--listResourceInfo&nbsp;bpmCluster&nbsp;vfs-repo</code></pre></div><div><br />This is the ideal configuration based on the commands above</div><div><div><pre><code class="son"><br />{<br />&nbsp; "id"&nbsp;:&nbsp;"vfs-repo",<br />&nbsp; "mapFields"&nbsp;:&nbsp;{<br />&nbsp; &nbsp; "vfs-repo_0"&nbsp;:&nbsp;{<br />&nbsp; &nbsp; &nbsp; "localhost_bpmClusterNode1"&nbsp;:&nbsp;"LEADER",<br />&nbsp; &nbsp; &nbsp; "localhost_bpmClusterNode2"&nbsp;:&nbsp;"STANDBY"<br />&nbsp; &nbsp; }<br />&nbsp; },<br />&nbsp; "listFields"&nbsp;:&nbsp;{<br />&nbsp; &nbsp; "vfs-repo_0"&nbsp;:&nbsp;[&nbsp;"localhost_bpmClusterNode1",&nbsp;"localhost_bpmClusterNode2"&nbsp;]<br />&nbsp; },<br />&nbsp; "simpleFields"&nbsp;:&nbsp;{<br />&nbsp; &nbsp; "IDEAL_STATE_MODE"&nbsp;:&nbsp;"AUTO",<br />&nbsp; &nbsp; "NUM_PARTITIONS"&nbsp;:&nbsp;"1",<br />&nbsp; &nbsp; "REBALANCE_MODE"&nbsp;:&nbsp;"SEMI_AUTO",<br />&nbsp; &nbsp; "REPLICAS"&nbsp;:&nbsp;"2",<br />&nbsp; &nbsp; "STATE_MODEL_DEF_REF"&nbsp;:&nbsp;"LeaderStandby",<br />&nbsp; &nbsp; "STATE_MODEL_FACTORY_NAME"&nbsp;:&nbsp;"DEFAULT"<br />&nbsp; }<br />}<br />ExternalView&nbsp;for&nbsp;vfs-repo:<br />{<br />&nbsp; "id"&nbsp;:&nbsp;"vfs-repo",<br />&nbsp; "mapFields"&nbsp;:&nbsp;{<br />&nbsp; &nbsp; "vfs-repo_0"&nbsp;:&nbsp;{<br />&nbsp; &nbsp; &nbsp; "localhost_bpmClusterNode1"&nbsp;:&nbsp;"OFFLINE",<br />&nbsp; &nbsp; &nbsp; "localhost_bpmClusterNode2"&nbsp;:&nbsp;"OFFLINE"<br />&nbsp; &nbsp; }<br />&nbsp; },<br />&nbsp; "listFields"&nbsp;:&nbsp;{<br />&nbsp; },<br />&nbsp; "simpleFields"&nbsp;:&nbsp;{<br />&nbsp; &nbsp; "BUCKET_SIZE"&nbsp;:&nbsp;"0"<br />&nbsp; }<br />}</code></pre></div></div><div><br /></div><div><ul><li>For single sign on (SSO), assuming security is setup correctly. &nbsp;Adding an application admin user on both systems should be sufficient.</li></ul></div><div>Modify standalone-full-ha.xml on both nodes, &lt;sso/&gt; property to</div><div><pre><code class="xml"><br />&lt;sso cache-container="web" cache-name="sso"/&gt;</code></pre></div><br /><ul><li>For your clustered runtime instances you will usually have a maven central repository, like nexus to be your maven central. &nbsp;A central artifact repository is ideal, but you still have to create the appropriate scripts to pull the artifacts. &nbsp;However, replication of maven artifacts via rsync is also an option as noted in the documentation.</li></ul><div><ul><li>In the quartz-definiton.properties, if you specify a jndiURL for managedDS that is different from what is specified as the jta-data-source in business-central.war you may encounter an exception where quartz is unable to locate the appropriate jndi url reference.</li></ul><div><pre><code class="java">13:41:14,467&nbsp;WARN&nbsp; [org.drools.persistence.SingleSessionCommandService]&nbsp;(http-/127.0.0.1:8080-6)&nbsp;Could&nbsp;not&nbsp;commit&nbsp;session:&nbsp;org.jbpm.workflow.instance.WorkflowRuntimeException:&nbsp;[TestProj7.Timer-Delay:6&nbsp;-&nbsp;Delay:3]&nbsp;--&nbsp;org.quartz.JobPersistenceException:&nbsp;Failed&nbsp;to&nbsp;obtain&nbsp;DB&nbsp;connection&nbsp;from&nbsp;data&nbsp;source&nbsp;'managedDS':&nbsp;java.sql.SQLException:&nbsp;Could&nbsp;not&nbsp;retrieve&nbsp;datasource&nbsp;via&nbsp;JNDI&nbsp;url&nbsp;'jboss/datasources/quartzXADS'&nbsp;java.sql.SQLException:&nbsp;javax.resource.ResourceException:&nbsp;IJ000460:&nbsp;Error&nbsp;checking&nbsp;for&nbsp;a&nbsp;transaction&nbsp;[See&nbsp;nested&nbsp;exception:&nbsp;java.sql.SQLException:&nbsp;Could&nbsp;not&nbsp;retrieve&nbsp;datasource&nbsp;via&nbsp;JNDI&nbsp;url&nbsp;'jboss/datasources/quartzXADS'&nbsp;java.sql.SQLException:&nbsp;javax.resource.ResourceException:&nbsp;IJ000460:&nbsp;Error&nbsp;checking&nbsp;for&nbsp;a&nbsp;transaction]</code></pre></div></div><div><br /></div><div><br /></div><br /><br /><br />References:<br />https://access.redhat.com/documentation/en-US/Red_Hat_JBoss_BPM_Suite/6.1/html/Installation_Guide/chap-Clustering.html<br />http://planet.jboss.org/post/clustering_in_jbpm_v6<br />https://opensourcebpm.wordpress.com/2014/04/27/redhat-jboss-bpms-design-time-clustering/</div></div>